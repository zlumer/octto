# octto

OpenCode plugin that turns rough ideas into designs through branch-based exploration with a browser UI.

## Quick Start

Add to `~/.config/opencode/opencode.json`:

```json
{ "plugin": ["/path/to/octto"] }
```

Select the **octto** agent, then describe your idea:

```
I want to add a caching layer to the API
```

A browser window opens with questions. Answer them. Get a design document.

## Configuration

Optionally configure agent settings in `~/.config/opencode/octto.json`:

```json
{
  "agents": {
    "octto": {
      "model": "anthropic/claude-opus-4",
      "temperature": 0.7
    }
  }
}
```

| Property | Type | Description |
|----------|------|-------------|
| `model` | string | Model identifier (e.g., `anthropic/claude-opus-4`, `anthropic/claude-sonnet-4`) |
| `temperature` | number | Sampling temperature (0-1) |
| `maxSteps` | number | Maximum agent steps |

Only these safe properties can be overridden. Missing config file is fine - defaults are used.

## Workflow

```
Request → Bootstrapper → Branches → Browser UI → Design Doc
              ↓              ↓           ↓
         [2-4 branches]  [questions]  [answers]
```

### Branch-Based Exploration

Instead of linear questioning, octto creates **parallel exploration branches**. Each branch has a scope (e.g., "Architecture", "Data Model", "Security") and asks questions within that scope.

```
User: "Add user authentication"
         ↓
    ┌────┴────┐
    ↓         ↓         ↓
[auth_method] [storage] [session]
    ↓         ↓         ↓
 OAuth?     Redis?    JWT?
 SAML?      Postgres? Cookie?
    ↓         ↓         ↓
  finding   finding   finding
         ↓
   Design Document
```

### Event-Driven Answer Processing

Answers are processed asynchronously as they arrive:

1. `create_brainstorm` - Creates branches, opens browser with initial questions
2. `await_brainstorm_complete` - Event loop that:
   - Waits for any answer (non-blocking)
   - Fires off async processing (records answer, evaluates branch)
   - Pushes follow-up questions or marks branch done
   - Continues until all branches complete
3. `show_plan` - Displays findings for review/approval
4. `end_brainstorm` - Writes design document

### Inline Probe Logic

Follow-up questions are generated by rules-based logic (no LLM call):

- After 1st answer: Ask about priorities (context-aware options)
- After 2nd answer: Confirm direction
- After 3rd answer: Mark branch done with synthesized finding

## Architecture

### Dual Session System

| Session | Purpose | Storage |
|---------|---------|---------|
| **State Session** | Branch state, Q&A history, findings | `.octto/{id}.json` |
| **Browser Session** | WebSocket connection, pending questions | In-memory |

### Agents

| Agent | Role |
|-------|------|
| `octto` | Orchestrator - coordinates flow |
| `bootstrapper` | Analyzes request, creates 2-4 branches with initial questions |

### Tools

| Tool | Description |
|------|-------------|
| `create_brainstorm` | Create session with branches, open browser |
| `await_brainstorm_complete` | Event loop - process answers until done |
| `get_session_summary` | Debug tool - view branch status |
| `end_brainstorm` | Close session, return findings |

### Question Types

| Type | Use Case |
|------|----------|
| `pick_one` | Choose ONE option |
| `pick_many` | Select MULTIPLE options |
| `confirm` | Yes/No decisions |
| `ask_text` | Free-form text input |
| `show_plan` | Document review with sections |
| `show_options` | Options with pros/cons |
| `show_diff` | Before/after code review |
| `rank` | Order items by priority |
| `rate` | Score items on scale |
| `slider` | Numeric range input |
| `thumbs` | Quick up/down feedback |

## Project Structure

```
src/
├── index.ts              # Plugin entry, event handlers
├── config-loader.ts      # User configuration loading
├── agents/
│   ├── octto.ts          # Orchestrator prompt
│   └── bootstrapper.ts   # Branch creation prompt
├── state/
│   ├── store.ts          # Branch state CRUD
│   ├── persistence.ts    # JSON file storage
│   └── types.ts          # BrainstormState, Branch
├── session/
│   ├── sessions.ts       # Browser session, WebSocket
│   ├── server.ts         # HTTP/WS server (Bun.serve)
│   ├── waiter.ts         # Async answer waiters
│   └── types.ts          # Question, Session types
├── tools/
│   ├── branch.ts         # create/await/end_brainstorm
│   ├── probe-logic.ts    # Rules-based follow-up generation
│   ├── questions.ts      # Question type tools
│   ├── responses.ts      # get_answer, get_next_answer
│   └── session.ts        # start/end_session (generic)
└── ui/
    └── bundle.ts         # Browser UI (inline HTML/CSS/JS)
```

## Design Output

Designs are written to:
```
docs/plans/YYYY-MM-DD-{topic}-design.md
```

## Development

```bash
bun install
bun run build
bun test
```

### Local Testing

```json
{ "plugin": ["/path/to/octto"] }
```

## How It Works

1. **Bootstrapper** analyzes your request and creates 2-4 branches with scopes
2. **create_brainstorm** saves state, opens browser with initial questions
3. **await_brainstorm_complete** enters event loop:
   - `getNextAnswer()` blocks until any question answered
   - `processAnswerAsync()` fires without blocking:
     - Records answer to state
     - Runs `evaluateBranch()` (inline probe logic)
     - Either completes branch or pushes follow-up
   - Loop continues until all branches done
4. **show_plan** displays findings in browser for approval
5. **end_brainstorm** returns findings for design doc generation

## Philosophy

1. **Parallel exploration** - Multiple aspects explored simultaneously
2. **Scoped questions** - Each branch stays within its scope
3. **Non-blocking processing** - Answers processed async, UI stays responsive
4. **Browser-first** - Visual UI beats terminal for complex input
5. **Human approval** - Review findings before generating design doc

## License

MIT
